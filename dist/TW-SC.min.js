const SKIN={size:{width:256,height:128},elements:{body:[0,0,96,96],body_shadow:[96,0,96,96],hand:[192,0,32,32],hand_shadow:[224,0,32,32],foot:[192,32,64,32],foot_shadow:[192,64,64,32],credits:[0,96,64,32],default_eye:[64,96,32,32],angry_eye:[96,96,32,32],blink_eye:[128,96,32,32],happy_eye:[160,96,32,32],cross_eye:[192,96,32,32],surprised_eye:[224,96,32,32]}};class Tee{constructor(e){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.elements=new Object,this.image=new Image,this.image.crossOrigin="",this.imageLink=e,this.teeEyesVariables=!1}async loadImage(e){this.image.src=e,await this.image.decode(),this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.canvas.style.width="256px",this.canvas.style.height="128px",this.lookAt(),this.ctx.drawImage(this.image,0,0,this.canvas.width,this.canvas.height)}isRatioLegal=()=>{const e=SKIN.size.width/SKIN.size.height;return this.image.width/this.image.height===e};getMultiplier=()=>this.image.width/SKIN.size.width;setColor(e,t){let s,i,a,h,r,n=this.currentImgData.data;for(r=0;r<n.length;r+=4){s=n[r],i=n[r+1],a=n[r+2],h=n[r+3];let o=new Color(s,i,a,h);COLOR_MODE[t](o,e),n[r]=o.r,n[r+1]=o.g,n[r+2]=o.b,n[r+3]=o.a}this.someImgData=n,this.setCanvas()}reorderBody(){let e,t=Array(256).fill(0),s=0,i=this.currentImgData.data;const a=192,h=255-s;for(e=0;e<i.length;e+=4)i[e+3]>128&&t[i[e]]++;for(let e=1;e<256;e++)t[s]<t[e]&&(s=e);for(e=0;e<i.length;e+=4){let t=i[e];t<=s&&0==s||(t=t<=s?Math.trunc(t/s*a):0==h?a:Math.trunc((t-s)/h*63+a),i[e]=t,i[e+1]=t,i[e+2]=t)}this.someImgData=i,this.setCanvas()}setCanvas(){this.currentCtx.putImageData(new ImageData(this.someImgData,this.d[2],this.d[3]),0,0)}isRatioLegal(){const e=SKIN.size.width/SKIN.size.height;return this.image.width/this.image.height===e}getMultiplier(){return this.image.width/SKIN.size.width}getColorArg(e,t){if(0==Object.keys(COLOR_FORMAT).includes(t))throw Error(`Invalid color format: ${t}\nValid formats: rgb, hsl, code`);return e=COLOR_FORMAT[t](e)}colorLimitForSkin(e,t=52.5){return e[2]<t&&(e[2]=t),e}colorConvert(e,t){return e=this.getColorArg(e,t),"rgb"==t&&(e=RGBToHSL(e[0],e[1],e[2])),e=this.colorLimitForSkin(e),e=HSLToRGB(e[0],e[1],e[2]),new Color(...e)}setColor2(e,t){e=this.colorConvert(e,t),this.setColor(e,"grayscale"),this.isBody&&this.reorderBody(),this.setColor(e,"default")}async getTeeImage(e="none",t="none",s="code"){await this.loadImage(this.imageLink),e=e.toString(),t=t.toString();let i=Object.keys(SKIN.elements);if(!this.isRatioLegal())throw Error("Image has wrong ratio.");for(let a in i){let h=i[a];this.elements[h]=document.createElement("canvas");let r=this.elements[h],n=this.getMultiplier();if(this.d=SKIN.elements[h].map((e=>e*n)),r.width=this.d[2],r.height=this.d[3],this.currentCtx=r.getContext("2d"),this.currentCtx.putImageData(this.ctx.getImageData(this.d[0],this.d[1],this.d[2],this.d[3]),0,0),"body"===i[a]?this.isBody=!0:this.isBody=!1,this.currentImgData=this.currentCtx.getImageData(0,0,this.d[2],this.d[3]),"none"!==e&&"none"!==t&&(h.includes("foot")?this.setColor2(t,s):h.includes("credits")||this.setColor2(e,s)),Object.keys(SKIN.elements)[i.length-1]===h){this.ctx.clearRect(0,0,this.ctx.width,this.ctx.height);for(let e=0;e<Object.keys(SKIN.elements).length;e++){let t=SKIN.elements[Object.keys(this.elements)[e]].map((e=>e*n));if(this.ctx.drawImage(this.elements[Object.keys(this.elements)[e]],t[0],t[1]),e===Object.keys(SKIN.elements).length-1)return this.result=this.canvas.toDataURL(),this.result}}}}teeEyesTranslateFunction(){this.markerCoord={x:this.marker.getBoundingClientRect().x,y:this.marker.getBoundingClientRect().y},this.teeEyes.style.transform=`translate(${this.markerCoord.x-this.teeRender.getBoundingClientRect().x+0}px, ${this.markerCoord.y-this.teeRender.getBoundingClientRect().y}px)`}setTeeEyesVariables(){this.teeEyesVariables=!0,this.teeRender=document.querySelector(".tee"),this.line=document.querySelector(".tee .line"),this.marker=document.querySelector(".tee .marker"),this.teeEyes=document.querySelector(".eyes")}lookAtCursor(){this.setTeeEyesVariables();let e=this.line.getBoundingClientRect().x.toFixed(),t=this.line.getBoundingClientRect().y.toFixed();this.moveTeeEyesFunction=s=>{this.line.style.transform=`translate(-1px, .5px) rotate(${180*Math.atan2(s.clientY-t,s.clientX-e)/Math.PI}deg)`,this.teeEyesTranslateFunction()},this.eyeMoveEvent=document.addEventListener("mousemove",this.moveTeeEyesFunction)}dontLookAtCursor(){document.removeEventListener("mousemove",this.moveTeeEyesFunction)}lookAt(e=0){!1===this.teeEyesVariables&&this.setTeeEyesVariables(),this.line.style.transform=`translate(-1px, .5px) rotate(${e}deg)`,this.teeEyesTranslateFunction()}}
//# sourceMappingURL=TW-SC.min.js.map